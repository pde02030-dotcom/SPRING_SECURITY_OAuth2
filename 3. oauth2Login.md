# `HttpSecurity.oauth2Login()` ì •ë¦¬ ğŸ§©ğŸ”

## âœ… ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜

```java
public OAuth2LoginConfigurer<HttpSecurity> oauth2Login() throws Exception
```

## âœ… í•œ ì¤„ ì •ì˜

ì´ ë©”ì„œë“œëŠ” Spring Securityì˜ **HttpSecurity DSL**ì—ì„œ
**OAuth 2.0 / OpenID Connect 1.0 ê¸°ë°˜ ë¡œê·¸ì¸(ì¸ì¦) íë¦„ì„ êµ¬ì„±**í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” **ì§„ì…ì (Entry Point)** ì…ë‹ˆë‹¤. ğŸšªâœ¨

---

# âœ… ì „ì²´ ë¬¸ì¥ í•´ì„ ë° êµ¬ì¡° ğŸ§ 

## ğŸ”¹ ì›ë¬¸

> Configures authentication support using an OAuth 2.0 and/or OpenID Connect 1.0 Provider. The "authentication flow" is implemented using the Authorization Code Grant, as specified in the OAuth 2.0 Authorization Framework and OpenID Connect Core 1.0 specification.

## ğŸ”¹ í•´ì„

ì´ ë©”ì„œë“œëŠ” **OAuth 2.0 ë˜ëŠ” OpenID Connect 1.0 Provider(ê³µê¸‰ì)** ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ ì§€ì›ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
ì—¬ê¸°ì„œ ë§í•˜ëŠ” â€œì¸ì¦ í”Œë¡œìš°(authentication flow)â€ëŠ” **Authorization Code Grant(ì¸ê°€ ì½”ë“œ ê·¸ëœíŠ¸)** ë¡œ êµ¬í˜„ë˜ë©°, ì´ëŠ” OAuth 2.0 Authorization Framework ë° OpenID Connect Core 1.0 ëª…ì„¸ì— ì •ì˜ëœ ë°©ì‹ì…ë‹ˆë‹¤. âœ…

---

# âœ… í•µì‹¬ í¬ì¸íŠ¸ ğŸ¯

### âœ… OAuth2Loginì€ ì–´ë–¤ í”Œë¡œìš°ë¥¼ ì“°ë‚˜?

* Spring Securityì˜ `oauth2Login()`ì€ ê¸°ë³¸ì ìœ¼ë¡œ **Authorization Code Grant** ê¸°ë°˜ì…ë‹ˆë‹¤. ğŸ”

  * ë¸Œë¼ìš°ì € ë¦¬ë‹¤ì´ë ‰íŠ¸ â†’ code ìˆ˜ì‹  â†’ token êµí™˜ â†’ userinfo ì¡°íšŒ â†’ SecurityContext ì €ì¥

### âœ… OAuth2 vs OIDC ê´€ê³„

* **OAuth2**: â€œì¸ê°€(Authorization)â€ í”„ë ˆì„ì›Œí¬
* **OIDC**: OAuth2 ìœ„ì— â€œì¸ì¦(Authentication)â€ì„ ì–¹ì€ í‘œì¤€

  * OIDCëŠ” ë³´í†µ `openid` scope í¬í•¨ + `id_token` ë°œê¸‰ + JWK ê²€ì¦ì´ ì—°ê²°ë©ë‹ˆë‹¤. ğŸªª

---

# âœ… êµ¬ì„± ìš”ì†Œì˜ ê´€ê³„ ğŸ§©

Spring Securityê°€ OAuth2 Loginì„ êµ¬ì„±í•  ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒ ê°ì²´ë“¤ì˜ ì—°ê³„ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

| êµ¬ì„± ìš”ì†Œ                          | ì—­í•                                                        |
| ------------------------------ | -------------------------------------------------------- |
| `ClientRegistration`           | Google/Naver/Kakao ê°™ì€ **Provider + Client ì„¤ì • ì •ë³´**ë¥¼ ë‹´ëŠ” ê°ì²´ |
| `ClientRegistrationRepository` | ì—¬ëŸ¬ ê°œì˜ `ClientRegistration`ì„ ë³´ê´€/ì¡°íšŒí•˜ëŠ” ì €ì¥ì†Œ                  |
| `SecurityFilterChain`          | ì‹¤ì œë¡œ ì¸ì¦/ì¸ê°€ í•„í„°ë“¤ì´ ë“±ë¡ë˜ëŠ” â€œí•„í„° ì²´ì¸ ì£¼ì²´â€                           |
| `OAuth2LoginConfigurer`        | `oauth2Login()` DSLì„ êµ¬ì„±í•˜ëŠ” ì„¤ì • ë„ìš°ë¯¸(Configurator)           |
| `OAuth2UserService`            | UserInfo Endpointì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒí•´ `OAuth2User`ë¥¼ ë§Œë“œëŠ” ì „ëµ     |
| `OidcUserService`              | OIDCì—ì„œ `id_token` + userinfo ê¸°ë°˜ìœ¼ë¡œ `OidcUser`ë¥¼ ë§Œë“œëŠ” ì „ëµ     |

---

# âœ… ì˜ˆì œ ì½”ë“œ êµ¬ì¡° í•´ì„¤ ğŸ§¾

```java
@Configuration
@EnableWebSecurity
public class OAuth2LoginSecurityConfig {

  @Bean
  public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
      .authorizeHttpRequests(auth -> auth
        .anyRequest().authenticated()
      )
      .oauth2Login(); // âœ… OAuth2 ë¡œê·¸ì¸ êµ¬ì„± ì§„ì…ì 

    return http.build();
  }

  @Bean
  public ClientRegistrationRepository clientRegistrationRepository() {
    return new InMemoryClientRegistrationRepository(this.googleClientRegistration());
  }

  private ClientRegistration googleClientRegistration() {
    return ClientRegistration.withRegistrationId("google")
      .clientId("google-client-id")
      .clientSecret("google-client-secret")

      .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
      .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)

      .redirectUri("{baseUrl}/login/oauth2/code/{registrationId}")
      .scope("openid", "profile", "email", "address", "phone")

      .authorizationUri("https://accounts.google.com/o/oauth2/v2/auth")
      .tokenUri("https://www.googleapis.com/oauth2/v4/token")

      .userInfoUri("https://www.googleapis.com/oauth2/v3/userinfo") // ğŸ’¡ UserInfo Endpoint
      .userNameAttributeName(IdTokenClaimNames.SUB)                 // ë³´í†µ "sub"

      .jwkSetUri("https://www.googleapis.com/oauth2/v3/certs")      // ğŸªª ID Token ì„œëª… ê²€ì¦ìš©
      .clientName("Google")
      .build();
  }
}
```

---

# âœ… ê° ì„¤ì • ìš”ì†Œ ìƒì„¸ ì„¤ëª… ğŸ§±

| ìš”ì†Œ                        | ì„¤ëª…                                                                        |
| ------------------------- | ------------------------------------------------------------------------- |
| `clientId / clientSecret` | Providerì—ì„œ ë°œê¸‰ë°›ì€ **í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ ì •ë³´**                                           |
| `authorizationGrantType`  | `AUTHORIZATION_CODE`: ë¸Œë¼ìš°ì € ë¦¬ë‹¤ì´ë ‰íŠ¸ ê¸°ë°˜ ì¸ê°€ ë°©ì‹                                 |
| `redirectUri`             | ë¡œê·¸ì¸ ì„±ê³µ í›„ Providerê°€ **ì¸ê°€ ì½”ë“œë¥¼ ë³´ë‚´ì¤„ redirect URI** (`{registrationId}` ìë™ ì¹˜í™˜) |
| `scope(...)`              | ìš”ì²­í•  ê¶Œí•œ ë²”ìœ„(ë™ì˜ ë²”ìœ„). ì˜ˆ: `openid`, `profile`, `email`                         |
| `authorizationUri`        | Authorization Endpoint (ì¸ê°€ ì½”ë“œ ë°›ê¸° ìœ„í•œ ì—”ë“œí¬ì¸íŠ¸)                                |
| `tokenUri`                | Token Endpoint (codeë¡œ access token êµí™˜)                                    |
| `userInfoUri`             | UserInfo Endpoint: access tokenìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API                           |
| `userNameAttributeName`   | userInfo JSONì—ì„œ â€œì‚¬ìš©ì ê³ ìœ  ì‹ë³„ìâ€ë¡œ ì“¸ key ì´ë¦„ (ë³´í†µ `sub`)                         |
| `jwkSetUri`               | OIDCì—ì„œ `id_token` JWT ì„œëª… ê²€ì¦ìš© ê³µê°œí‚¤(JWK Set) URI                             |

---

# âœ… ìë™ ìƒì„±ë˜ëŠ” ê¸°ë³¸ ê²½ë¡œ(Endpoint) ğŸ—ºï¸

| ê²½ë¡œ                                       | ì„¤ëª…                                                |
| ---------------------------------------- | ------------------------------------------------- |
| `/login`                                 | ë””í´íŠ¸ ë¡œê·¸ì¸ í˜ì´ì§€(Provider ë§í¬ ìë™ ë…¸ì¶œ)                    |
| `/oauth2/authorization/{registrationId}` | OAuth2 ë¡œê·¸ì¸ ì‹œì‘ ì§„ì…ì (Authorization Request ìƒì„±/ë¦¬ë‹¤ì´ë ‰íŠ¸) |
| `/login/oauth2/code/{registrationId}`    | Providerê°€ ì¸ì¦ í›„ redirectí•˜ëŠ” ì½œë°± URI(code/state ìˆ˜ì‹ )   |
| `/login?error`                           | ì¸ì¦ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë¦¬ë‹¤ì´ë ‰ì…˜                                  |

---

# âœ… Spring Security ë‚´ë¶€ êµ¬ì„± íë¦„ ğŸ§ âš™ï¸

1. `http.oauth2Login()` í˜¸ì¶œ
2. `OAuth2LoginConfigurer`ê°€ ìƒì„±ë˜ì–´ DSL êµ¬ì„±ì„ ìˆ˜ì§‘
3. ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒì„ ì—°ê²°/ë“±ë¡

   * `ClientRegistrationRepository` ì—°ê²°
   * FilterChainì— í•„í„° ë“±ë¡

     * `OAuth2AuthorizationRequestRedirectFilter` (ë‚˜ê°ˆ ë•Œ) ğŸš€
     * `OAuth2LoginAuthenticationFilter` (ëŒì•„ì˜¬ ë•Œ) ğŸ”
   * Token êµí™˜ ì „ëµ ì—°ê²°

     * `DefaultAuthorizationCodeTokenResponseClient` ğŸ«
   * UserInfo í˜¸ì¶œ ì „ëµ ì—°ê²°

     * `DefaultOAuth2UserService` / `OidcUserService` ğŸ‘¤ğŸªª
4. ì¸ì¦ ì„±ê³µ ì‹œ `SecurityContext`ì— `OAuth2AuthenticationToken` ì €ì¥ ğŸ”

---

# âœ… ê³ ê¸‰ ì„¤ì • ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì‹œ ğŸ”§ğŸ”¥

```java
http
  .oauth2Login(oauth2 -> oauth2
    .loginPage("/custom-login") // ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ í˜ì´ì§€
    .userInfoEndpoint(userInfo -> userInfo
      .userService(customOAuth2UserService)   // OAuth2UserService ì»¤ìŠ¤í…€
      // .oidcUserService(customOidcUserService) // OIDCë„ ë³„ë„ë¡œ ê°€ëŠ¥
    )
  );
```

---

# âœ… ìš”ì•½ ğŸ§¾âœ¨

| í•­ëª©                | ì„¤ëª…                                                   |
| ----------------- | ---------------------------------------------------- |
| ë©”ì„œë“œ               | `oauth2Login()`                                      |
| ì •ì˜ ìœ„ì¹˜             | `HttpSecurity`                                       |
| ë°˜í™˜ íƒ€ì…             | `OAuth2LoginConfigurer<HttpSecurity>`                |
| ëª©ì                 | OAuth2/OIDC ë¡œê·¸ì¸ íë¦„ì„ êµ¬ì„±í•˜ëŠ” DSL ì§„ì…ì                      |
| í•„ìˆ˜ ê°ì²´             | `ClientRegistration`, `ClientRegistrationRepository` |
| UserInfo Endpoint | Access Tokenìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì–»ëŠ” API                        |
| í™•ì¥ ë°©ë²•             | `.userInfoEndpoint().userService(...)` ë“±ìœ¼ë¡œ ì»¤ìŠ¤í…€       |

