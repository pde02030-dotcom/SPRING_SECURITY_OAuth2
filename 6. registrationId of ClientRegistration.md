# ğŸ§© `ClientRegistration.registrationId`

> Spring Security OAuth2ì—ì„œ â€œì´ ë¡œê·¸ì¸ì€ ëˆ„êµ¬ ê²ƒì´ëƒ?â€ë¥¼ êµ¬ë¶„í•˜ëŠ” í•µì‹¬ í‚¤ ğŸ”‘

OAuth2 Loginì„ ì„¤ì •í•˜ë‹¤ ë³´ë©´ ë°˜ë“œì‹œ ë“±ì¥í•˜ëŠ” í´ë˜ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤.

ğŸ‘‰ `org.springframework.security.oauth2.client.registration.ClientRegistration`

ê·¸ë¦¬ê³  ê·¸ ì•ˆì—ì„œ ê°€ì¥ ìì£¼ ë³´ì´ëŠ” í•„ë“œê°€ ë°”ë¡œ:

```java
private String registrationId;
```

ì˜¤ëŠ˜ì€ ì´ **registrationIdê°€ ì •í™•íˆ ë¬´ì—‡ì´ë©°, ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€** ê¹Šê²Œ íŒŒí—¤ì³ ë³´ê² ìŠµë‹ˆë‹¤. ğŸ”¬âœ¨

---

## 1ï¸âƒ£ registrationIdë€ ë¬´ì—‡ì¸ê°€?

### í•œ ì¤„ ì •ì˜

> **registrationIdëŠ” â€œí´ë¼ì´ì–¸íŠ¸ ë“±ë¡(Provider ì„¤ì •)ì˜ ë…¼ë¦¬ì  ì‹ë³„ìâ€ì…ë‹ˆë‹¤.**

ì¦‰, ì—¬ëŸ¬ OAuth2 Providerë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ë•Œ
ê° Provider ì„¤ì •ì„ êµ¬ë¶„í•˜ëŠ” **ì´ë¦„(label)** ì…ë‹ˆë‹¤.

ì˜ˆ:

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: xxx
            client-secret: yyy
          github:
            client-id: aaa
            client-secret: bbb
```

ì—¬ê¸°ì„œ:

* `google`
* `github`

ğŸ‘‰ ì´ ê°’ë“¤ì´ ë°”ë¡œ **registrationId** ì…ë‹ˆë‹¤.

---

## 2ï¸âƒ£ registrationIdëŠ” ì–´ë””ì— ì“°ì´ëŠ”ê°€? (ì•„í‚¤í…ì²˜ ë ˆë²¨)

registrationIdëŠ” ë‹¨ìˆœ ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤.
OAuth2 ë¡œê·¸ì¸ ì „ì²´ íë¦„ì—ì„œ **í•µì‹¬ í‚¤ ì—­í• **ì„ í•©ë‹ˆë‹¤.

---

## ğŸ”„ 1. ë¡œê·¸ì¸ ì‹œì‘ URL êµ¬ì„±

Spring Security ê¸°ë³¸ ë¡œê·¸ì¸ URL:

```
/oauth2/authorization/{registrationId}
```

ì˜ˆ:

```
/oauth2/authorization/google
/oauth2/authorization/github
```

ì—¬ê¸°ì„œ `{registrationId}`ê°€ ë°”ë¡œ ì„¤ì • íŒŒì¼ì˜ registrationIdì…ë‹ˆë‹¤.

### ë‚´ë¶€ ë™ì‘ íë¦„

```
OAuth2AuthorizationRequestRedirectFilter
          â†“
ClientRegistrationRepository.findByRegistrationId("google")
          â†“
google ì„¤ì •ì„ êº¼ë‚´ì„œ Authorization Endpointë¡œ redirect
```

ì¦‰,

> registrationIdëŠ” â€œì–´ëŠ Provider ì„¤ì •ì„ ì‚¬ìš©í• ì§€â€ë¥¼ ê²°ì •í•˜ëŠ” í‚¤ ğŸ”‘

---

## ğŸ”„ 2. Authorization Code Callback ì²˜ë¦¬

Callback URL ê¸°ë³¸ íŒ¨í„´:

```
/login/oauth2/code/{registrationId}
```

ì˜ˆ:

```
/login/oauth2/code/google
```

ì—¬ê¸°ì„œë„ ë™ì¼í•˜ê²Œ registrationIdë¥¼ ê¸°ë°˜ìœ¼ë¡œ:

* ì–´ë–¤ ClientRegistrationì¸ì§€ ì¡°íšŒ
* ì–´ë–¤ Token URIë¥¼ ì“¸ì§€ ê²°ì •
* ì–´ë–¤ UserInfo URIë¥¼ í˜¸ì¶œí• ì§€ ê²°ì •

---

## ğŸ§  ë‚´ë¶€ êµ¬ì¡° ì´í•´

### ClientRegistration ì£¼ìš” í•„ë“œ êµ¬ì¡°

```java
public final class ClientRegistration {

    private String registrationId;      // â­ í•µì‹¬
    private String clientId;
    private String clientSecret;
    private AuthorizationGrantType authorizationGrantType;
    private String redirectUri;

    private ProviderDetails providerDetails;
    private Set<String> scopes;
}
```

registrationIdëŠ” ë‹¨ìˆœí•œ í•„ë“œì²˜ëŸ¼ ë³´ì´ì§€ë§Œ
**ClientRegistrationRepositoryì—ì„œ Mapì˜ key ì—­í• **ì„ í•©ë‹ˆë‹¤.

### ë‚´ë¶€ ì €ì¥ êµ¬ì¡° (InMemoryClientRegistrationRepository)

```java
Map<String, ClientRegistration> registrations;
```

key = registrationId
value = ClientRegistration ê°ì²´

---

## 3ï¸âƒ£ ì™œ êµ³ì´ registrationIdê°€ í•„ìš”í•œê°€?

### ğŸ¯ ì´ìœ  1: Multi-Provider ì§€ì›

í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ:

* Google ë¡œê·¸ì¸
* GitHub ë¡œê·¸ì¸
* ì‚¬ë‚´ OAuth ì„œë²„ ë¡œê·¸ì¸
* Kakao ë¡œê·¸ì¸

ëª¨ë‘ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ëŸ´ ë•Œ ê° Provider ì„¤ì •ì„ êµ¬ë¶„í•  IDê°€ í•„ìš”í•©ë‹ˆë‹¤.

ğŸ‘‰ ê·¸ê²Œ registrationIdì…ë‹ˆë‹¤.

---

### ğŸ¯ ì´ìœ  2: Providerì™€ ë¶„ë¦¬ëœ êµ¬ì¡°

registrationId â‰  provider

Spring Bootì—ëŠ” ì´ëŸ° êµ¬ì¡°ê°€ ìˆìŠµë‹ˆë‹¤:

```yaml
spring.security.oauth2.client.registration.google
spring.security.oauth2.client.provider.google
```

* registration â†’ â€œì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì“°ëŠ” í´ë¼ì´ì–¸íŠ¸ ì„¤ì •â€
* provider â†’ â€œOAuth ì„œë²„ ë©”íƒ€ë°ì´í„° ì„¤ì •â€

ì¦‰:

> registrationIdëŠ” "ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ì¤€ì˜ í´ë¼ì´ì–¸íŠ¸ ì´ë¦„"ì´ì§€
> ë°˜ë“œì‹œ ì‹¤ì œ Provider ì´ë¦„ì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

---

## ğŸ”¥ ê³ ê¸‰ ì˜ˆì œ: ë™ì¼ Provider, ë‹¤ë¥¸ registrationId

ì˜ˆ:

```yaml
registration:
  google-login:
    provider: google
    client-id: xxx
  google-admin:
    provider: google
    client-id: yyy
```

ì—¬ê¸°ì„œëŠ”

* google-login
* google-admin

ë‘˜ ë‹¤ Googleì„ ì“°ì§€ë§Œ

ğŸ‘‰ registrationIdëŠ” ë‹¤ë¦…ë‹ˆë‹¤.

ì¦‰,

> registrationIdëŠ” Provider ì‹ë³„ìê°€ ì•„ë‹ˆë¼
> "Client ì„¤ì • ì¸ìŠ¤í„´ìŠ¤ ì‹ë³„ì" ì…ë‹ˆë‹¤.

---

## 4ï¸âƒ£ OAuth2AuthenticationTokenì—ì„œì˜ registrationId

ë¡œê·¸ì¸ ì„±ê³µ í›„ ìƒì„±ë˜ëŠ” ê°ì²´:

```
OAuth2AuthenticationToken
```

ì´ ê°ì²´ ì•ˆì— registrationIdê°€ ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.

```java
authentication.getAuthorizedClientRegistrationId();
```

ì´ ê°’ì€ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

### ì™œ ì¤‘ìš”í• ê¹Œ?

* ì‚¬ìš©ìê°€ ì–´ë–¤ Providerë¡œ ë¡œê·¸ì¸í–ˆëŠ”ì§€ ì‹ë³„ ê°€ëŠ¥
* DBì— â€œprovider ì¢…ë¥˜â€ ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥ ê°€ëŠ¥
* logout ì‹œ providerë³„ ì²˜ë¦¬ ê°€ëŠ¥
* providerë³„ role ë§¤í•‘ ê°€ëŠ¥

---

## 5ï¸âƒ£ registrationIdì™€ userNameAttributeNameì˜ ê´€ê³„

registrationIdëŠ” **ì–´ë–¤ Provider ì„¤ì •ì„ ì‚¬ìš©í• ì§€** ê²°ì •í•©ë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ:

```
registrationId â†’ ClientRegistration ì¡°íšŒ
                 â†’ userInfoEndpoint ì„¤ì •
                 â†’ userNameAttributeName ê²°ì •
```

ì¦‰,

> registrationIdê°€ ë°”ë€Œë©´ userInfo mapping ì „ëµë„ ë°”ë€ë‹ˆë‹¤.

ê·¸ë˜ì„œ ì»¤ìŠ¤í…€ OAuth2UserServiceì—ì„œ ì´ëŸ° ì½”ë“œê°€ ìì£¼ ë‚˜ì˜µë‹ˆë‹¤:

```java
String registrationId =
    userRequest.getClientRegistration().getRegistrationId();
```

ì´ ê°’ìœ¼ë¡œ provider ë¶„ê¸° ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## 6ï¸âƒ£ ë³´ì•ˆ ê´€ì ì—ì„œ registrationId

### âš ï¸ registrationIdëŠ” ì™¸ë¶€ì— ë…¸ì¶œë©ë‹ˆë‹¤

```
/oauth2/authorization/google
```

ì´ URLì— ë…¸ì¶œë˜ë¯€ë¡œ

* ì˜ˆì¸¡ ê°€ëŠ¥
* ê³µê°œ ì •ë³´

ì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ:

* clientSecretì€ ë…¸ì¶œë˜ì§€ ì•ŠìŒ
* registrationIdëŠ” ë‹¨ìˆœ ì‹ë³„ìì´ë¯€ë¡œ ë¯¼ê°ì •ë³´ ì•„ë‹˜

---

## 7ï¸âƒ£ registrationId vs clientName

í—·ê°ˆë¦¬ëŠ” í•„ë“œ í•˜ë‚˜ ë” ìˆìŠµë‹ˆë‹¤:

```java
clientName
```

ì°¨ì´:

| í•„ë“œ             | ì˜ë¯¸           |
| -------------- | ------------ |
| registrationId | ë‚´ë¶€ ì‹ë³„ì (key) |
| clientName     | UI í‘œì‹œìš© ì´ë¦„    |

ì˜ˆ:

```yaml
google:
  client-name: Google Login
```

* registrationId = google
* clientName = Google Login

---

## 8ï¸âƒ£ ì‹¤ë¬´ ì„¤ê³„ íŒ ğŸ’¡

### âœ… 1. registrationIdëŠ” ì†Œë¬¸ì ìœ ì§€

Spring ê¸°ë³¸ ê·œì¹™ê³¼ URL íŒ¨í„´ ìœ ì§€ ìœ„í•´

```
google
github
kakao
naver
```

### âœ… 2. DBì— provider ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥

```sql
provider VARCHAR(30)
```

ê°’:

```
google
github
kakao
```

â†’ registrationId ê·¸ëŒ€ë¡œ ì €ì¥í•˜ëŠ” ê²Œ ì¼ë°˜ì 

---

## 9ï¸âƒ£ ì „ì²´ êµ¬ì¡° ìš”ì•½ ë‹¤ì´ì–´ê·¸ë¨

```
/oauth2/authorization/google
             â†“
OAuth2AuthorizationRequestRedirectFilter
             â†“
ClientRegistrationRepository
   key = "google"
             â†“
ClientRegistration
             â†“
Token ìš”ì²­
             â†“
UserInfo ìš”ì²­
             â†“
OAuth2AuthenticationToken
   registrationId = "google"
```

---

# ğŸ¯ ìµœì¢… ì •ë¦¬

| ê°œë…             | ì„¤ëª…                                     |
| -------------- | -------------------------------------- |
| registrationId | ClientRegistrationì˜ ë…¼ë¦¬ì  ì‹ë³„ì            |
| ì—­í•              | Provider ì„¤ì •ì„ ì°¾ëŠ” key                    |
| URLì— ì‚¬ìš©        | /oauth2/authorization/{registrationId} |
| ì¸ì¦ ê°ì²´ì— í¬í•¨      | OAuth2AuthenticationToken ë‚´ë¶€           |
| DB ì €ì¥ìš©         | provider êµ¬ë¶„ ê°’ìœ¼ë¡œ í™œìš©                     |

---

# ğŸ”¥ í•œ ë¬¸ì¥ ì •ë¦¬

> registrationIdëŠ” â€œì´ OAuth2 ë¡œê·¸ì¸ ì„¤ì •ì´ ëˆ„êµ¬ ê²ƒì¸ì§€â€ë¥¼ êµ¬ë¶„í•˜ëŠ” ë‚´ë¶€ ì‹ë³„ìì´ì, OAuth2 íë¦„ ì „ì²´ë¥¼ ì—°ê²°í•˜ëŠ” í•µì‹¬ í‚¤ì…ë‹ˆë‹¤. ğŸ”‘

